import java.util.Arrays;
import java.util.LinkedList;
import java.util.Scanner;

/**
 * Implementation of the ClientConsoleUI
 * 
 * @author Alex Bowen
 * @version 0.0.1
 *
 */

public class ClientConsoleUI implements IClientConsoleUI 
{
	//TEMPORARY list of saved servers
	private LinkedList<SavedServerInfo> _savedServers = new LinkedList<SavedServerInfo>(Arrays.asList(
			new SavedServerInfo("192.168.1.2", "SomeServer"),
			new SavedServerInfo("172.16.5.7", "Dorks of Zork"),
			new SavedServerInfo("66.66.66.66", "A Whole Other Level")
			));
	
	private Scanner _kb;

	public ClientConsoleUI(Scanner kb)
	{
		_kb = kb;
	}
	
	@Override
	public void startUI()
	{
		NextUIScreenEnum nextScreen = NextUIScreenEnum.MainMenu;
		
		do{
			
			switch(nextScreen)
			{
			case MainMenu:
				nextScreen = mainMenu();
				break;
			case AddServer:
				nextScreen = addServer();
				break;
			case SavedServers:
				nextScreen = savedServers();
				break;
			case Quit:
				return;
			}
			
		}while(true);
	}
	
	@Override
	public NextUIScreenEnum mainMenu() 
	{
		clearScreen();
		for (String l : ConsoleUIConstants.C_8025WelcomeScreen)
		{
			System.out.println(l);
		}
		
		String input;
		
		do
		{
			input = _kb.nextLine().toLowerCase();
			
			if(input.equals("a") || input.equals("add") || input.equals("add server"))
			{
				return NextUIScreenEnum.AddServer;
			}
			else if(input.equals("s") || input.equals("saved") || input.equals("saved servers"))
			{
				return NextUIScreenEnum.SavedServers;
			}
			else if(input.equals("q") || input.equals("quit"))
			{
				return NextUIScreenEnum.Quit;
			}
			else
			{
				clearScreen();
				for (String l : ConsoleUIConstants.C_8025WelcomeScreen)
				{
					System.out.println(l);
				}
			}
		}while(true);
	}

	@Override
	public NextUIScreenEnum addServer() 
	{
		clearScreen();
		System.out.print("Enter new Server IP: ");
		String newIP = _kb.nextLine();
		System.out.println("Retrieving info for DORK server on " + newIP + "...");
		String serverName = "A new server";	
		System.out.println("Successfully found server " + serverName + " on " + newIP + ".");
		
		SavedServerInfo newServer = new SavedServerInfo(newIP, serverName);
		
		boolean inList = false;
		
		for(SavedServerInfo s : _savedServers)
		{
			if(s.equals(newServer))
			{
				inList = true;
				break;
			}
		}
		
		if(!inList)
		{
			System.out.print("Save in list? ");
			if(_kb.nextLine().toLowerCase().contains("y"))
			{
				_savedServers.add(newServer);
			}
		}
		else
		{
			System.out.println("Server is already saved!");
		}
		
		if(!_savedServers.isEmpty())
		{
			return NextUIScreenEnum.SavedServers;
		}
		else
		{
			return NextUIScreenEnum.MainMenu;
		}
	}

	@Override
	public NextUIScreenEnum savedServers() 
	{
		return NextUIScreenEnum.MainMenu;
	}
	
	private void clearScreen()
	{
		try
	    {
	        final String os = System.getProperty("os.name");

	        if (os.contains("Windows"))
	        {
	            Runtime.getRuntime().exec("cls");
	        }
	        else
	        {
	            Runtime.getRuntime().exec("clear");
	        }
	    }
	    catch (final Exception e)
	    {
	        //if this fails, at least get to a new line
	    	System.out.println();
	    }
	}
}
